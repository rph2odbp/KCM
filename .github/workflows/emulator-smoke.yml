name: Emulator Smoke

on:
  workflow_dispatch: {}
  pull_request:
    branches: [ main ]

jobs:
  smoke:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Enable Corepack
        run: corepack enable
      - name: Install
        run: yarn --cwd kateri-monorepo install --immutable
      - name: Build functions
        run: |
          yarn --cwd kateri-monorepo workspace @kateri/functions-gen2 run build
      - name: Run emulators smoke
        env:
          FB_PROJECT_ID: kcm-firebase-b7d6a
          FB_REGION: us-central1
          FB_DB_ID: kcm-db
        run: |
          yarn dlx firebase-tools emulators:exec --only functions,firestore --project kcm-firebase-b7d6a -- node kateri-monorepo/scripts/emulator-smoke.js
name: Emulator Smoke Test

on:
  workflow_dispatch:

jobs:
  smoke:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20"

      - name: Enable Corepack (Yarn 4)
        run: corepack enable

      - name: Install dependencies
        working-directory: kateri-monorepo
        run: yarn install --immutable

      - name: Firebase Tools
        run: yarn dlx firebase-tools --version

      - name: Smoke test
        run: |
          yarn dlx firebase-tools emulators:exec --only firestore,auth,storage --project kcm-firebase-b7d6a 'echo ok'
